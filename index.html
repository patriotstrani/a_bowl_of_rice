<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Миска риса</title>
<style>
  :root { --card:#fff; --border:#444; --bg:#f0f0f0; }
  * { box-sizing: border-box; }
  body {
    font-family: Arial, sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
    padding: 40px 12px;
  }
  #game {
    border: 5px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    padding: 20px;
    width: 420px;
    max-width: 100%;
    box-shadow: 0 8px 24px rgba(0,0,0,.12);
  }
  #status, #messages {
    margin-bottom: 16px;
    white-space: pre-line;
  }
  #messages { color: #1558d6; min-height: 1.2em; }
  .btn {
    width: 100%;
    margin: 6px 0;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    background: #fafafa;
    cursor: pointer;
    transition: transform .05s ease, background .15s ease;
  }
  .btn:hover { background: #eee; }
  .btn:active { transform: translateY(1px); }
</style>
</head>
<body>
  <div id="game">
    <div id="status"></div>
    <div id="messages"></div>

    <button id="btnWork" class="btn">Работать</button>
    <button id="btnShop" class="btn">Магазин</button>
    <button id="btnBuyProduct" class="btn">Купить продукт</button>
    <button id="btnBuyPot" class="btn">Купить кастрюлю (20₩)</button>
    <button id="btnCook" class="btn">Готовить</button>
    <button id="btnSell" class="btn">Продать блюдо</button>
    <button id="btnCookbook" class="btn">Кулинарная книга</button>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- Состояние игры ---
  let money = 50;
  let inventory = {};
  let pot = false;

  const dishes = {
      "Жареный рис": {"Рис":1,"Морковь":1,"Яйцо":1},
      "Суп кимчи": {"Кимчи":1,"Вода":1,"Тофу":1},
      "Бибимбап": {"Рис":1,"Мясо":1,"Морковь":1,"Яйцо":1},
      "Пульгоги": {"Мясо":2,"Соевый соус":1},
      "Кимчи пицца": {"Кимчи":1,"Тесто":1,"Сыр":1},
      "Десерт рисовый": {"Рис":1,"Сахар":1,"Молоко":1},
      "Токпокки": {"Рисовые клецки":1,"Соус чили":1},
      "Салат из моркови": {"Морковь":2,"Масло":1},
      "Рамен": {"Лапша":1,"Бульон":1,"Яйцо":1},
      "Кимчи рис": {"Рис":1,"Кимчи":1}
  };

  const store = {
      "Рис":5,"Морковь":3,"Яйцо":2,"Кимчи":7,
      "Мясо":10,"Соевый соус":4,"Тесто":5,"Сыр":4,
      "Сахар":2,"Молоко":3,"Рисовые клецки":4,
      "Соус чили":3,"Масло":2,"Лапша":3,"Бульон":4,"Тофу":5
  };

  // --- Вспомогательные функции ---
  function updateStatus() {
    const invText = Object.keys(inventory).length
      ? Object.entries(inventory).map(([k,v]) => ${k}: ${v}).join("\n")
      : "Пусто";
    document.getElementById("status").innerText =
      Деньги: ${money}₩\nИнвентарь:\n${invText}\nЕсть кастрюля: ${pot ? 'Да' : 'Нет'};
  }

  function updateMessages(text="", delay=3000) {
    const box = document.getElementById("messages");
    box.innerText = text;
    if (delay > 0) setTimeout(() => { box.innerText = ""; }, delay);
  }

  // --- Игровые действия ---
  function work() {
    const earnings = Math.floor(Math.random() * 11) + 5; // 5..15
    money += earnings;
    updateMessages(Вы заработали ${earnings}₩);
    updateStatus();
  }

  function showShop() {
    let t = "=== Магазин ===\n";
    for (const item in store) t += ${item}: ${store[item]}₩\n;
    updateMessages(t, 5000);
  }

  function buyProduct() {
    const product = prompt("Введите название продукта:");
    if (!product || !(product in store)) {
      updateMessages("Неверный продукт"); return;
    }
    const amount = parseInt(prompt(Сколько «${product}» купить?), 10);
    if (isNaN(amount) || amount < 1) { updateMessages("Покупка отменена"); return; }
    const total = store[product] * amount;
    if (money >= total) {
      money -= total;
      inventory[product] = (inventory[product] || 0) + amount;
      updateMessages(Вы купили ${amount} × ${product});
    } else {
      updateMessages("Недостаточно денег!");
    }
    updateStatus();
  }

  function buyPot() {
    if (pot) { updateMessages("У вас уже есть кастрюля"); return; }
    if (money >= 20) { money -= 20; pot = true; updateMessages("Вы купили кастрюлю!"); }
    else { updateMessages("Недостаточно денег!"); }
    updateStatus();
  }

  function cook() {
    if (!pot) { updateMessages("У вас нет кастрюли!"); return; }
    const dish = prompt("Введите название блюда:");
    if (!dish || !(dish in dishes)) { updateMessages("Неверное блюдо"); return; }

    const missing = [];
    for (const ing in dishes[dish]) {
      const need = dishes[dish][ing] - (inventory[ing] || 0);
      if (need > 0) missing.push(${ing} x${need});
    }
    if (missing.length) { updateMessages(Недостаточно ингредиентов: ${missing.join(", ")}); return; }

    const answer = prompt(Готовим «${dish}»? Напишите 'да' чтобы продолжить);
    if (!answer || answer.toLowerCase() !== "да") { updateMessages("Готовка отменена"); return; }

    for (const ing in dishes[dish]) inventory[ing] -= dishes[dish][ing];
    inventory[dish] = (inventory[dish] || 0) + 1;
    updateMessages(Вы приготовили ${dish});
    // чистим инвентарь от нулей
    for (const k of Object.keys(inventory)) if (inventory[k] <= 0) delete inventory[k];
    updateStatus();
  }

  function sell() {
    const sellable = Object.keys(inventory).filter(name => dishes[name]);
    if (!sellable.length) { updateMessages("Нет блюд для продажи"); return; }
    const item = sellable[Math.floor(Math.random() * sellable.length)];
    const price = Math.floor(Math.random() * 21) + 10; // 10..30

    if (Math.random() < 0.2) {
      money -= 10;
      updateMessages("Вас поймали и выписали штраф 10₩!");
    } else {
      inventory[item] -= 1;
      if (inventory[item] <= 0) delete inventory[item];
      money += price;
      updateMessages(Вы продали ${item} за ${price}₩);
    }
    updateStatus();
  }

  function showCookbook() {
    let text = "=== Кулинарная книга ===\n";
    for (const dish in dishes) {
      const ing = Object.entries(dishes[dish]).map(([k,v]) => ${k} x${v}).join(", ");
      text += ${dish}: ${ing}\n;
    }
    updateMessages(text, 6000);
  }

  // --- Навешиваем обработчики (никаких onclick в HTML) ---
  document.getElementById('btnWork').addEventListener('click', work);
  document.getElementById('btnShop').addEventListener('click', showShop);
  document.getElementById('btnBuyProduct').addEventListener('click', buyProduct);
  document.getElementById('btnBuyPot').addEventListener('click', buyPot);
  document.getElementById('btnCook').addEventListener('click', cook);
  document.getElementById('btnSell').addEventListener('click', sell);
  document.getElementById('btnCookbook').addEventListener('click', showCookbook);

  // Первый рендер
  updateStatus();
});
</script>
</body>
</html>
